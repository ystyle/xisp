;; ======================================
;; 现代化语法 (Modern Syntax) 示例
;; ======================================
;; Xisp 支持现代化的 Lisp 语法特性

;; ==================== 1. 向量字面量 [] ====================
;; 创建向量（内部转换为列表）
[1 2 3]
;; => (1.000000 2.000000 3.000000)

;; 向量可以包含任意类型
[1 "hello" #t]
;; => (1.000000 "hello" true)

;; 嵌套向量
[[1 2] [3 4]]
;; => ((1.000000 2.000000) (3.000000 4.000000))

;; ==================== 2. 哈希映射字面量 {} ====================
;; 创建关联列表
{:name "Alice" :age 30 :city "Beijing"}
;; => ((:name . "Alice") (:age . 30.000000) (:city . "Beijing"))

;; 嵌套哈希映射
{:user {:name "Bob" :id 123} :role :admin}
;; => ((:user . (:name . "Bob" :id . 123.000000)) (:role . :admin))

;; ==================== 3. 哈希集合字面量 #{} ====================
;; 创建集合（内部转换为列表）
#{1 2 3 4 5}
;; => (1.000000 2.000000 3.000000 4.000000 5.000000)

;; 符号集合
#{:red :green :blue}
;; => (:red :green :blue)

;; ==================== 4. 字符串插值 #"" ====================
;; 在字符串中插入变量和表达式
#"Value is: {x}"
;; 插入多个值
#"x={x}, y={y}, sum={+ x y}"

;; 复杂表达式插值
#"Result: {* x x}"  ; x 的平方

;; ==================== 5. 解构绑定 (let) ====================
;; 使用 let 进行解构绑定
(let [(x y z) (quote (1 2 3))]
  (str "x=" x ", y=" y ", z=" z))
;; => "x=1.000000, y=2.000000, z=3.000000"

;; 嵌套解构
(let [((a b) (c d)) (quote ((1 2) (3 4)))]
  (str "a=" a ", b=" b ", c=" c ", d=" d))
;; => "a=1.000000, b=2.000000, c=3.000000, d=4.000000"

;; ==================== 6. 管道操作符 -> ====================
;; 线程宏：将前一个结果作为后一个函数的第一个参数
(-> 10
    (+ 5)
    (* 2))
;; => 30.000000

;; 复杂管道操作
(-> (quote (1 2 3 4 5))
  (map (lambda (x) (* x x)))
  (filter (lambda (x) (> x 5)))
  (reduce + 0))
;; => 54.000000 (16 + 25)

;; ==================== 7. 高阶函数 lambda 支持 ====================
;; map、filter、reduce 都支持 lambda

;; 使用 lambda 映射
(map (lambda (x) (* x x))
     (quote (1 2 3 4 5)))
;; => (1.000000 4.000000 9.000000 16.000000 25.000000)

;; 使用 lambda 过滤
(filter (lambda (x) (> x 3))
        (quote (1 2 3 4 5)))
;; => (4.000000 5.000000)

;; 使用 lambda 归约
(reduce (lambda (acc x) (+ acc x))
        0
        (quote (1 2 3 4 5)))
;; => 15.000000

;; ==================== 8. 组合使用 ====================
;; 管道 + lambda + 字面量
(define numbers [1 2 3 4 5])

(-> numbers
    (map (lambda (n) (* n n)))
    (filter (lambda (n) (> n 5)))
    (reduce + 0))
;; => 54.000000
