;; ======================================
;; 管道操作符 (Thread Macro) 示例
;; ======================================

(println "=== Xisp 管道操作符演示 ===")
(println "")

(println "1. 基本用法")
(println "代码: (-> 1 (+ 2) (+ 3) (+ 4))")
(println "说明: 等价于 (+ 1 2) => (+ 3 3) => (+ 6 4)")
(define r1 (-> 1 (+ 2) (+ 3) (+ 4)))
(println #"结果: #{r1}")
(println "期望: 10.000000")
(println "")

(println "2. 链式列表操作")
(println "代码: (-> (quote (1 2 3 4 5)) (rest) (rest) (first))")
(println "等价于: (first (rest (rest '(1 2 3 4 5))))")
(define r2 (-> (quote (1 2 3 4 5)) (rest) (rest) (first)))
(println #"结果: #{r2}")
(println "期望: 3.000000")
(println "")

(println "3. 与高阶函数结合")
(println "代码: (-> (quote (1 2 3 4 5)) (map (lambda (x) (* x x))) (filter (lambda (x) (> x 5))) (reduce + 0))")
(println "说明: (1 4 9 16 25) 过滤 (> 5) => (9 16 25) 求和 => 50")
(define r3 (-> (quote (1 2 3 4 5))
    (map (lambda (x) (* x x)))
    (filter (lambda (x) (> x 5)))
    (reduce + 0)))
(println #"结果: #{r3}")
(println "期望: 50.000000")
(println "")

(println "4. 定义辅助函数使用管道")
(println "代码: (define (square x) (* x x)) (-> 5 square (+ 10) square)")
(println "说明: (square 5) => 25, (+ 25 10) => 35, (square 35) => 1225")
(define (square x) (* x x))
(define r4 (-> 5 square (+ 10) square))
(println #"结果: #{r4}")
(println "期望: 1225.000000")
(println "")

(println "5. 数据转换管道")
(println "代码: (-> [1 2 3 4 5] (map (lambda (x) (* x 2))) (filter (lambda (x) (> x 5))) (reduce + 0))")
(println "说明: (2 4 6 8 10) 过滤 (> 5) => (6 8 10) 求和 => 24")
(define data [1 2 3 4 5])
(define r5 (-> data
    (map (lambda (x) (* x 2)))
    (filter (lambda (x) (> x 5)))
    (reduce + 0)))
(println #"结果: #{r5}")
(println "期望: 24.000000")
(println "")

(println "6. 与 apply 结合 - 直接使用内置函数")
(println "代码: (-> (quote (1 2 3 4 5)) (apply +))")
(println "说明: apply + 到列表 (1 2 3 4 5) => 15")
(define r6 (-> (quote (1 2 3 4 5)) (apply +)))
(println #"结果: #{r6}")
(println "期望: 15.000000")
(println "")

(println "7. 实际应用：数据处理")
(println "代码: (-> [1 2 3 4 5 6 7 8 9 10] (filter (lambda (x) (= 0 (mod x 2)))) (map (lambda (x) (* x x))) (reduce + 0))")
(println "说明: 过滤偶数，平方，求和 => (4 + 16 + 36 + 64 + 100) = 220")
(define numbers [1 2 3 4 5 6 7 8 9 10])
(define r7 (-> numbers
    (filter (lambda (x) (= 0 (mod x 2))))
    (map (lambda (x) (* x x)))
    (reduce + 0)))
(println #"结果: #{r7}")
(println "期望: 220.000000")
