# Xisp æ–‡æ¡£ç¤ºä¾‹ä¸­ä¸æ”¯æŒçš„åŠŸèƒ½æ¸…å•

**ç”Ÿæˆæ—¶é—´**: 2026-01-25
**æµ‹è¯•çŠ¶æ€**: å·²éªŒè¯

---

## âŒ ç¡®è®¤ä¸æ”¯æŒçš„åŠŸèƒ½ï¼ˆ6ä¸ªï¼‰

### 1. ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**é—®é¢˜**:
- `(= :ok :ok)` â†’ `false` (åº”è¯¥æ˜¯ `true`)
- `(eq? :ok :ok)` â†’ `nil` (åº”è¯¥æ˜¯ `true`)
- `(eq? "a" "a")` â†’ `nil` (å­—ç¬¦ä¸²ä¹Ÿä¸æ”¯æŒ)

**å½±å“èŒƒå›´**: æ–‡æ¡£ä¸­å¤šå¤„ä½¿ç”¨ç¬¦å·ä½œä¸ºçŠ¶æ€ç /ç±»å‹æ ‡è®°çš„ç¤ºä¾‹

**å»ºè®®å®ç°**:
```cangjie
// åœ¨ builtin_logic.cj ä¸­æ·»åŠ 
env.define("eq?", NativeFunc({ args =>
    if (args.size != 2) {
        return Nil
    }
    match ((args[0], args[1])) {
        case (Symbol(s1), Symbol(s2)) => Boolean(s1 == s2)
        case (Str(s1), Str(s2)) => Boolean(s1 == s2)
        case (LispValue.Int(i1), LispValue.Int(i2)) => Boolean(i1 == i2)
        case _ => Boolean(false)
    }
}))
```

---

### 2. å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**é—®é¢˜**:
- `string=` å‡½æ•°ä¸å­˜åœ¨
- æ— æ³•ç”¨ `=` æ¯”è¾ƒå­—ç¬¦ä¸² (`(= "a" "a")` â†’ `false`)
- ä¹‹å‰æ–‡æ¡£ç¤ºä¾‹ç”¨äº† `string=` ä½†åŠŸèƒ½æœªå®ç°

**å½±å“èŒƒå›´**:
- æ•°æ®è¿‡æ»¤ç¤ºä¾‹ï¼ˆfilter by cityï¼‰
- ä»»ä½•éœ€è¦å­—ç¬¦ä¸²æ¯”è¾ƒçš„åœºæ™¯

**å»ºè®®å®ç°**:
```cangjie
env.define("string=", NativeFunc({ args =>
    if (args.size != 2) {
        return Nil
    }
    match ((args[0], args[1])) {
        case (Str(s1), Str(s2)) => Boolean(s1 == s2)
        case _ => {
            println("Error: string= requires two strings")
            Nil
        }
    }
}))

env.define("string<", NativeFunc({ args =>
    if (args.size != 2) {
        return Nil
    }
    match ((args[0], args[1])) {
        case (Str(s1), Str(s2)) => Boolean(s1 < s2)
        case _ => Nil
    }
}))

env.define("string>", NativeFunc({ args =>
    if (args.size != 2) {
        return Nil
    }
    match ((args[0], args[1])) {
        case (Str(s1), Str(s2)) => Boolean(s1 > s2)
        case _ => Nil
    }
}))
```

---

### 3. å“ˆå¸Œæ˜ å°„è§£æ„

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(let [[{:host h :port p}] [{:host "localhost" :port 8080}]])
;; h â†’ nil, p â†’ nil (åº”è¯¥æ˜¯ "localhost" å’Œ 8080)
```

**å½±å“èŒƒå›´**:
- é…ç½®è§£æç¤ºä¾‹
- ä»»ä½•éœ€è¦è§£æ„å“ˆå¸Œæ˜ å°„çš„åœºæ™¯

**å½“å‰è§£å†³æ–¹æ¡ˆ**:
```lisp
;; âœ… ä½¿ç”¨ hget
(let ((config {:host "localhost" :port 8080})
      (h (hget config :host))
      (p (hget config :port)))
  ...)
```

**å»ºè®®**: éœ€è¦æ‰©å±• eval_let.cj ä¸­çš„è§£æ„é€»è¾‘

---

### 4. match å“ˆå¸Œæ˜ å°„æ¨¡å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(match {:name "Alice" :age 30}
  [{:name n :age a} (println n a)])
;; æ²¡æœ‰è¾“å‡ºï¼ŒåŒ¹é…å¤±è´¥
```

**å½±å“èŒƒå›´**:
- ç°ä»£è¯­æ³•æ–‡æ¡£ä¸­çš„ç¤ºä¾‹
- ä½¿ç”¨å“ˆå¸Œæ˜ å°„ä½œä¸ºæ•°æ®ç»“æ„çš„åœºæ™¯

**å»ºè®®**: éœ€è¦æ‰©å±• eval_match.cj æ”¯æŒ HashMap æ¨¡å¼

---

### 5. å­—ç¬¦ä¸²æ’å€¼ä¸­çš„å‡½æ•°è°ƒç”¨

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
#"Result: #{(hget m :name)}"
;; è¾“å‡º: "Result: #{(hget m :name)}" (æ²¡æœ‰æ±‚å€¼)
```

**åªæ”¯æŒ**:
- ç®€å•å˜é‡: `#"Name: #{name}"` âœ…
- ç®€å•è¡¨è¾¾å¼: `#"Sum: #{+ x y}"` âœ…
- **ä¸æ”¯æŒ**å‡½æ•°è°ƒç”¨: `#{(func arg)}` âŒ

**å½±å“èŒƒå›´**: è¾ƒå°ï¼ˆå·²æœ‰ println æ›¿ä»£æ–¹æ¡ˆï¼‰

---

### 6. match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ å¤šè¡Œå®ˆå«æ¡ä»¶è¿”å› nil
(match 15
  (x when (> x 10)) (str "large: " x)
  (x when (< x 5)) (str "small: " x)
  _ "medium")
; => nil (é”™è¯¯)

;; âœ… å•è¡Œå®ˆå«æ¡ä»¶å¯ä»¥å·¥ä½œ
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")
; => "large: 15"
```

**å½±å“èŒƒå›´**:
- æ–‡æ¡£ä¸­çš„å®ˆå«æ¡ä»¶ç¤ºä¾‹
- éœ€è¦å¤æ‚å®ˆå«æ¡ä»¶çš„ä¸šåŠ¡é€»è¾‘

**æµ‹è¯•ç»“æœ**:
- âœ… å¤šè¡Œå¸¸é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œåˆ—è¡¨è§£æ„ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œå‘é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âŒ å¤šè¡Œå®ˆå«æ¡ä»¶ï¼šè¿”å› nil
- âœ… å•è¡Œå®ˆå«æ¡ä»¶ï¼šå·¥ä½œæ­£å¸¸

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
```lisp
;; ä½¿ç”¨å•è¡Œæ ¼å¼
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")

;; æˆ–è€…ä½¿ç”¨åµŒå¥— if ä»£æ›¿
(if (> x 10)
    (str "large: " x)
    (if (< x 5)
        (str "small: " x)
        "medium"))
```

**å»ºè®®**: éœ€è¦ä¿®å¤ parser æˆ– eval_match ä¸­çš„å®ˆå«æ¡ä»¶è§£æé€»è¾‘

---

## âœ… ç¡®è®¤æ”¯æŒçš„åŠŸèƒ½

1. âœ… ç®€å•å‘é‡è§£æ„: `let [[x y] [1 2]]`
2. âœ… å‘é‡è§£æ„ with &: `let [[x y & rest] [1 2 3 4 5]]`
3. âœ… åµŒå¥—å‘é‡è§£æ„: `let [[[a b] c] [[1 2] 3]]`
4. âœ… match ç¬¦å·åŒ¹é…: `match :admin :admin "Administrator"`
5. âœ… match å¤šè¡Œå¸¸é‡åŒ¹é…ã€åˆ—è¡¨è§£æ„ã€å‘é‡åŒ¹é…ï¼ˆé™¤å®ˆå«æ¡ä»¶å¤–ï¼‰

---

## å®ç°ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ** (`eq?`)
   - åŸå› ï¼šå½±å“ matchã€æ¡ä»¶åˆ¤æ–­ç­‰æ ¸å¿ƒåŠŸèƒ½
   - å®ç°éš¾åº¦ï¼šä½
   - æ–‡ä»¶ï¼š`src/core/builtin_logic.cj`

2. **å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°** (`string=`, `string<`, `string>`)
   - åŸå› ï¼šå¸¸è§çš„æ•°æ®å¤„ç†éœ€æ±‚
   - å®ç°éš¾åº¦ï¼šä½
   - æ–‡ä»¶ï¼š`src/core/builtin_string.cj` (æ–°å»º)

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¢å¼ºè¯­æ³•ç‰¹æ€§ï¼‰

3. **match å“ˆå¸Œæ˜ å°„åŒ¹é…**
   - åŸå› ï¼šæå‡ match çš„å®ç”¨æ€§
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_match.cj`

4. **å“ˆå¸Œæ˜ å°„è§£æ„**
   - åŸå› ï¼šè®©ä»£ç æ›´ç®€æ´
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_let.cj`

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ä½“éªŒï¼‰

5. **match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼**
   - åŸå› ï¼šæœ‰å•è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥— if
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/parser/parser.cj` æˆ– `src/core/eval_match.cj`

6. **å­—ç¬¦ä¸²æ’å€¼å‡½æ•°è°ƒç”¨**
   - åŸå› ï¼šå·²æœ‰ println å¤šå‚æ•°æ›¿ä»£æ–¹æ¡ˆ
   - å®ç°éš¾åº¦ï¼šé«˜
   - æ–‡ä»¶ï¼š`src/parser/parser.cj`

---

## æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
./target/release/bin/ystyle::xisp.cli /tmp/test_unsupported.lisp

# æˆ–æ‰‹åŠ¨æµ‹è¯•
cjpm test --show-all-output
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… æ–‡æ¡£å·²ä¿®æ­£ä¸ºä½¿ç”¨æ”¯æŒçš„è¯­æ³•
2. â³ å¾…å®ç°ï¼šé«˜ä¼˜å…ˆçº§åŠŸèƒ½ï¼ˆç¬¦å·æ¯”è¾ƒã€å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰
3. ğŸ“ è€ƒè™‘ï¼šä¸­ä½ä¼˜å…ˆçº§åŠŸèƒ½çš„å®ç°è®¡åˆ’

**æœ€åæ›´æ–°**: 2026-01-25
**ç›¸å…³æäº¤**: 305a29f, a5eb701, e0935d3, 4ee0c9b
