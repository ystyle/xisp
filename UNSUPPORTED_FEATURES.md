# Xisp æ–‡æ¡£ç¤ºä¾‹ä¸­ä¸æ”¯æŒçš„åŠŸèƒ½æ¸…å•

**ç”Ÿæˆæ—¶é—´**: 2026-01-27
**æµ‹è¯•çŠ¶æ€**: å·²éªŒè¯

---

## âŒ ç¡®è®¤ä¸æ”¯æŒçš„åŠŸèƒ½ï¼ˆ5ä¸ªï¼‰

### 1. å®/å‡½æ•°çš„å¯å˜å‚æ•°

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
- `(defmacro foo (. args) ...)` - å¯å˜å‚æ•°è¯­æ³•ä¸æ”¯æŒ
- `(define (foo . args) ...)` - å‡½æ•°çš„å¯å˜å‚æ•°ä¸æ”¯æŒ
- `(defmacro foo (x &rest) ...)` - &rest è¯­æ³•ä¸æ”¯æŒ

**å½±å“èŒƒå›´**:
- éœ€è¦æ¥å—ä»»æ„æ•°é‡å‚æ•°çš„å®å®šä¹‰
- æ–‡æ¡£ä¸­çš„ `print-all`, `create-function`, `unless` ç¤ºä¾‹
- æ— æ³•å®ç°æ ‡å‡†çš„ whileã€dotimes ç­‰æ§åˆ¶ç»“æ„å®

**å…·ä½“è¡¨ç°**:
```lisp
; âŒ å°è¯•ä½¿ç”¨ . rest å‚æ•°
(defmacro test (. args)
  `(begin ,@args))
(test 1 2 3)
; å±•å¼€ï¼šargs åªæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œä¸æ˜¯åˆ—è¡¨
; å¯¼è‡´æ— æ³•ä½¿ç”¨å¯å˜å‚æ•°

; âŒ å°è¯•ä½¿ç”¨ ,@ æ‹¼æ¥
(defmacro test (args)
  `(begin ,@args))
; bug: ,@ åªä¿ç•™ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå…¶ä»–å…ƒç´ ä¸¢å¤±
```

**å»ºè®®å®ç°**:
- åœ¨è§£æå™¨ä¸­æ·»åŠ å¯å˜å‚æ•°æ”¯æŒ
- å‚è€ƒ Common Lisp çš„ `. args` æˆ– Scheme çš„è¯­æ³•
- ä¿®å¤ `,@` (comma-at) çš„å±•å¼€é€»è¾‘

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
```lisp
; å›ºå®šå‚æ•°çš„å®
(defmacro print-2 (a b)
  `(begin
     (println ,a)
     (println ,b)))

; ä½¿ç”¨å†…ç½®çš„è¿­ä»£åŠŸèƒ½
(dotimes i 5 (println i))

; å¯¹äºéœ€è¦å¤šä¸ªè¡¨è¾¾å¼çš„æƒ…å†µï¼Œä½¿ç”¨ begin ç»„åˆ
(dotimes i 5
  (begin
    (println i)
    (set! i (+ i 1))))
```

---

### 2. ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ

**çŠ¶æ€**: âœ… å·²å®ç°

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**: `eq?` - ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆæ”¯æŒç¬¦å·ã€å­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ã€nilï¼‰

**å®ç°ä½ç½®**: `src/core/builtin_logic.cj`

**æµ‹è¯•æ–‡ä»¶**: `lisp-tests/equality_test.lisp`

---

### 3. å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°

**çŠ¶æ€**: âœ… å·²å®ç°

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**å·²å®ç°**:
- `string=?` - å­—ç¬¦ä¸²ç›¸ç­‰æ¯”è¾ƒï¼ˆå·²å®ç°åœ¨ builtin_print.cjï¼‰
- `string<` - å­—ç¬¦ä¸²å°äºæ¯”è¾ƒï¼ˆå·²å®ç°åœ¨ builtin_print.cjï¼‰
- `string>` - å­—ç¬¦ä¸²å¤§äºæ¯”è¾ƒï¼ˆå·²å®ç°åœ¨ builtin_print.cjï¼‰

**å®ç°ä½ç½®**: `src/core/builtin_print.cj`

**æµ‹è¯•æ–‡ä»¶**: `lisp-tests/equality_test.lisp`

---

### 4. å“ˆå¸Œæ˜ å°„è§£æ„

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(let [[{:host h :port p}] [{:host "localhost" :port 8080}]])
;; h â†’ nil, p â†’ nil (åº”è¯¥æ˜¯ "localhost" å’Œ 8080)
```

**å½±å“èŒƒå›´**:
- é…ç½®è§£æç¤ºä¾‹
- ä»»ä½•éœ€è¦è§£æ„å“ˆå¸Œæ˜ å°„çš„åœºæ™¯

**å½“å‰è§£å†³æ–¹æ¡ˆ**:
```lisp
;; âœ… ä½¿ç”¨ hget
(let ((config {:host "localhost" :port 8080})
      (h (hget config :host))
      (p (hget config :port)))
  ...)
```

**å»ºè®®**: éœ€è¦æ‰©å±• eval_let.cj ä¸­çš„è§£æ„é€»è¾‘

---

### 5. match å“ˆå¸Œæ˜ å°„æ¨¡å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
(match {:name "Alice" :age 30}
  [{:name n :age a} (println n a)])
;; æ²¡æœ‰è¾“å‡ºï¼ŒåŒ¹é…å¤±è´¥
```

**å½±å“èŒƒå›´**:
- ç°ä»£è¯­æ³•æ–‡æ¡£ä¸­çš„ç¤ºä¾‹
- ä½¿ç”¨å“ˆå¸Œæ˜ å°„ä½œä¸ºæ•°æ®ç»“æ„çš„åœºæ™¯

**å»ºè®®**: éœ€è¦æ‰©å±• eval_match.cj æ”¯æŒ HashMap æ¨¡å¼

---

### 6. å­—ç¬¦ä¸²æ’å€¼ä¸­çš„å‡½æ•°è°ƒç”¨

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

**é—®é¢˜**:
```lisp
;; âŒ ä¸å·¥ä½œ
#"Result: #{(hget m :name)}"
;; è¾“å‡º: "Result: #{(hget m :name)}" (æ²¡æœ‰æ±‚å€¼)
```

**åªæ”¯æŒ**:
- ç®€å•å˜é‡: `#"Name: #{name}"` âœ…
- ç®€å•è¡¨è¾¾å¼: `#"Sum: #{+ x y}"` âœ…
- **ä¸æ”¯æŒ**å‡½æ•°è°ƒç”¨: `#{(func arg)}` âŒ

**å½±å“èŒƒå›´**: è¾ƒå°ï¼ˆå·²æœ‰ println æ›¿ä»£æ–¹æ¡ˆï¼‰

---

### 7. match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**é—®é¢˜**:
```lisp
;; âŒ å¤šè¡Œå®ˆå«æ¡ä»¶è¿”å› nil
(match 15
  (x when (> x 10)) (str "large: " x)
  (x when (< x 5)) (str "small: " x)
  _ "medium")
; => nil (é”™è¯¯)

;; âœ… å•è¡Œå®ˆå«æ¡ä»¶å¯ä»¥å·¥ä½œ
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")
; => "large: 15"
```

**å½±å“èŒƒå›´**:
- æ–‡æ¡£ä¸­çš„å®ˆå«æ¡ä»¶ç¤ºä¾‹
- éœ€è¦å¤æ‚å®ˆå«æ¡ä»¶çš„ä¸šåŠ¡é€»è¾‘

**æµ‹è¯•ç»“æœ**:
- âœ… å¤šè¡Œå¸¸é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œåˆ—è¡¨è§£æ„ï¼šå·¥ä½œæ­£å¸¸
- âœ… å¤šè¡Œå‘é‡åŒ¹é…ï¼šå·¥ä½œæ­£å¸¸
- âŒ å¤šè¡Œå®ˆå«æ¡ä»¶ï¼šè¿”å› nil
- âœ… å•è¡Œå®ˆå«æ¡ä»¶ï¼šå·¥ä½œæ­£å¸¸

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
```lisp
;; ä½¿ç”¨å•è¡Œæ ¼å¼
(match 15 (x when (> x 10)) (str "large: " x) (x when (< x 10)) (str "small: " x)) _ "medium")

;; æˆ–è€…ä½¿ç”¨åµŒå¥— if ä»£æ›¿
(if (> x 10)
    (str "large: " x)
    (if (< x 5)
        (str "small: " x)
        "medium"))
```

**å»ºè®®**: éœ€è¦ä¿®å¤ parser æˆ– eval_match ä¸­çš„å®ˆå«æ¡ä»¶è§£æé€»è¾‘

---

## âœ… ç¡®è®¤æ”¯æŒçš„åŠŸèƒ½

1. âœ… ç®€å•å‘é‡è§£æ„: `let [[x y] [1 2]]`
2. âœ… å‘é‡è§£æ„ with &: `let [[x y & rest] [1 2 3 4 5]]`
3. âœ… åµŒå¥—å‘é‡è§£æ„: `let [[[a b] c] [[1 2] 3]]`
4. âœ… match ç¬¦å·åŒ¹é…: `match :admin :admin "Administrator"`
5. âœ… match å¤šè¡Œå¸¸é‡åŒ¹é…ã€åˆ—è¡¨è§£æ„ã€å‘é‡åŒ¹é…ï¼ˆé™¤å®ˆå«æ¡ä»¶å¤–ï¼‰

---

## å®ç°ä¼˜å…ˆçº§å»ºè®®

### âœ… å·²å®Œæˆé«˜ä¼˜å…ˆçº§åŠŸèƒ½

1. âœ… **ç¬¦å·/å…³é”®å­—æ¯”è¾ƒ** (`eq?`) - 2026-01-27 å®Œæˆ
2. âœ… **å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°** (`string=?`, `string<`, `string>`) - 2026-01-27 å®Œæˆ

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¢å¼ºè¯­æ³•ç‰¹æ€§ï¼‰

3. **å®/å‡½æ•°çš„å¯å˜å‚æ•°** (å»ºè®®ä¸‹ä¸€ä¸ªå®ç°)
   - åŸå› ï¼šå½±å“å®çš„çµæ´»æ€§ï¼Œæ˜¯å…ƒç¼–ç¨‹çš„åŸºç¡€
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/parser/parser.cj`

4. **match å“ˆå¸Œæ˜ å°„åŒ¹é…**
   - åŸå› ï¼šæå‡ match çš„å®ç”¨æ€§
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_match.cj`

5. **å“ˆå¸Œæ˜ å°„è§£æ„**
   - åŸå› ï¼šè®©ä»£ç æ›´ç®€æ´
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/core/eval_let.cj`

6. **match å®ˆå«æ¡ä»¶å¤šè¡Œæ ¼å¼**
   - åŸå› ï¼šæœ‰å•è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥— if
   - å®ç°éš¾åº¦ï¼šä¸­
   - æ–‡ä»¶ï¼š`src/parser/parser.cj` æˆ– `src/core/eval_match.cj`

### ğŸŸ¢ ä½ä¼˜å…ˆçº§

7. **å­—ç¬¦ä¸²æ’å€¼å‡½æ•°è°ƒç”¨**
   - åŸå› ï¼šå·²æœ‰ println å¤šå‚æ•°æ›¿ä»£æ–¹æ¡ˆ
   - å®ç°éš¾åº¦ï¼šé«˜
   - æ–‡ä»¶ï¼š`src/parser/parser.cj`

---

## æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
./target/release/bin/ystyle::xisp.cli /tmp/test_unsupported.lisp

# æˆ–æ‰‹åŠ¨æµ‹è¯•
cjpm test --show-all-output
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… æ–‡æ¡£å·²ä¿®æ­£ä¸ºä½¿ç”¨æ”¯æŒçš„è¯­æ³•
2. âœ… æ·»åŠ å¯å˜å‚æ•°ä¸æ”¯æŒè¯´æ˜
3. âœ… å·²å®ç°ï¼šé«˜ä¼˜å…ˆçº§åŠŸèƒ½ï¼ˆeq? ç¬¦å·æ¯”è¾ƒã€string<ã€string> å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰
4. ğŸ“ è€ƒè™‘ï¼šä¸­ä½ä¼˜å…ˆçº§åŠŸèƒ½çš„å®ç°è®¡åˆ’

**æœ€åæ›´æ–°**: 2026-01-27
**ç›¸å…³æäº¤**: [å¾…æäº¤]
