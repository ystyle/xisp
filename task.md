# Xisp ä»»åŠ¡æ¸…å•

> ä»“é¢‰åµŒå…¥å¼ Lisp è„šæœ¬è¯­è¨€ - å¼€å‘è¿›åº¦ç®¡ç†

---

## ğŸ“Š æ€»ä½“è¿›åº¦

- âœ… M1: æ ¸å¿ƒ Lisp è§£é‡Šå™¨ (MVP)
- âœ… M2: ä»“é¢‰äº’æ“ä½œæ¡¥æ¥
- âœ… M3: ç°ä»£åŒ–è¯­æ³•æ‰©å±•
- âœ… M3.5: æ¨¡å—ç³»ç»ŸåŸºç¡€
- ğŸš§ M4: é«˜çº§ç‰¹æ€§å’Œå®Œå–„

---

## M1: æ ¸å¿ƒ Lisp è§£é‡Šå™¨ (MVP) âœ…

- [x] è§£æå’Œæ±‚å€¼ S-è¡¨è¾¾å¼
- [x] æ ¸å¿ƒç‰¹æ®Šå½¢å¼ï¼ˆdefine, lambda, if, quote, letï¼‰
- [x] é—­åŒ…å’Œè¯æ³•ä½œç”¨åŸŸ
- [x] REPL äº¤äº’
- [x] æ ¸å¿ƒæµ‹è¯•å¥—ä»¶ï¼ˆ183ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**å®Œæˆæ—¶é—´**: 2026-01-21

---

## M2: ä»“é¢‰äº’æ“ä½œæ¡¥æ¥ âœ…

- [x] Lisp â†’ ä»“é¢‰å‡½æ•°è°ƒç”¨
- [ ] ä»“é¢‰ â†’ Lisp å‡½æ•°è°ƒç”¨
- [x] std.io æ¡¥æ¥
- [x] std.fs æ¡¥æ¥
- [x] LispInterpreter API
- [x] æ¡¥æ¥å±‚æ–‡æ¡£

**å®Œæˆæ—¶é—´**: 2026-01-22

---

## M3: ç°ä»£åŒ–è¯­æ³•æ‰©å±• âœ…

- [x] è§£æ„ç»‘å®š
- [x] ç®¡é“æ“ä½œç¬¦ (->)
- [x] å‘é‡å­—é¢é‡ []
- [x] å“ˆå¸Œæ˜ å°„å­—é¢é‡ {}
- [x] å“ˆå¸Œé›†åˆå­—é¢é‡ #{}
- [x] å­—ç¬¦ä¸²æ’å€¼ #"{}"
- [x] é«˜é˜¶å‡½æ•° (map/filter/reduce)

**å®Œæˆæ—¶é—´**: 2026-01-22

---

## M3.5: æ¨¡å—ç³»ç»Ÿ âœ…

- [x] æ¨¡å—å‘½åç©ºé—´ (ç»„ç»‡å::åŒ…å)
- [x] æ¨¡å—å…ƒæ•°æ® (module.lisp)
- [x] æ¨¡å—åŠ è½½å’Œæ³¨å†Œ
- [x] ä¾èµ–è§£æ
- [x] ç›¸å¯¹è·¯å¾„å¯¼å…¥ (./local.lisp)
- [x] ç»å¯¹è·¯å¾„å¯¼å…¥ (org::module)
- [x] ç¬¦å·å¯¼å‡º (export)
- [x] æ¨¡å—ç³»ç»Ÿæµ‹è¯•ï¼ˆ183ä¸ªæµ‹è¯•é€šè¿‡ï¼‰

**å®Œæˆæ—¶é—´**: 2026-01-24

---

## M4: é«˜çº§ç‰¹æ€§å’Œå®Œå–„ ğŸš§

### 4.1 å¯å˜å‚æ•°å’Œå®ç³»ç»Ÿ âœ…
- [x] lambda å¯å˜å‚æ•° (. rest å’Œ &rest rest)
- [x] define å‡½æ•°å¯å˜å‚æ•°
- [x] ,@ (comma-at) æ‹¼æ¥åŠŸèƒ½
- [x] eval ç‰¹æ®Šå½¢å¼
- [x] macroexpand è¿”å›è¯­æ³•æ ‘
- [x] å®çš„çº¯å¯å˜å‚æ•° bugï¼ˆbindMacroParams ä¿®å¤ï¼‰ âœ… å·²ä¿®å¤ (2026-01-27)

### 4.2 æ–‡ä»¶å’Œè„šæœ¬æ”¯æŒ âœ…
- [x] evalFile å®ç°ï¼ˆé€šè¿‡ runScript + evalMultipleï¼‰
- [x] CLI è„šæœ¬è¿è¡Œå‚æ•°ï¼ˆ-c æ‰§è¡Œä»£ç ã€ç›´æ¥è¿è¡Œ .lisp æ–‡ä»¶ï¼‰
- [x] shebang æ”¯æŒï¼ˆLexer å¿½ç•¥ #! è¡Œï¼‰

### 4.3 HashMap è§£æ„å’Œæ¨¡å¼åŒ¹é… âœ…
- [x] HashMap è§£æ„ï¼š`(let [{:key1 var1 :key2 var2} hashmap-value] ...)`
- [x] match HashMap æ¨¡å¼åŒ¹é…ï¼š`(match value {:key1 var1 :key2 var2} result)`

### 4.4 æ¨¡å—ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰

> å½“å‰æ¨¡å—ç³»ç»Ÿè®¾è®¡å·²å®Œå–„ï¼š
> âœ… ç»å¯¹å¯¼å…¥ `(import org::module)`
> âœ… ç›¸å¯¹å¯¼å…¥ `(import "./file.lisp")` `(import "./package")`
> âœ… æ¨¡å—å…ƒæ•°æ® `module.lisp`
> âœ… ç¬¦å·å¯¼å‡º `(export ...)`
> âœ… ä¾èµ–ç®¡ç† `(dependencies ...)`
> âœ… æœç´¢è·¯å¾„ `XISP_PATH`
> âœ… ç‰ˆæœ¬ç®¡ç†ï¼ˆç²¾ç¡®ç‰ˆæœ¬ + @ç‰ˆæœ¬å· ç›®å½•ï¼‰
> âœ… ç›®å½•ç‰ˆæœ¬ç®¡ç† `org/module@0.1.0/`
>
> ç‰ˆæœ¬ç®¡ç†è¯´æ˜ï¼š
> - é‡‡ç”¨ç²¾ç¡®ç‰ˆæœ¬åŒ¹é…ï¼Œé¿å…å¤æ‚ä¾èµ–è§£æ
> - é€šè¿‡ @ç‰ˆæœ¬å· ç›®å½•å®ç°å¤šç‰ˆæœ¬å…±å­˜
> - ä½¿ç”¨ latest æ ‡è®°è·å–é»˜è®¤ç‰ˆæœ¬
> - ä¸æ”¯æŒç‰ˆæœ¬èŒƒå›´è¯­æ³•ï¼ˆ^, ~, >=, <=ï¼‰ï¼Œä¿æŒç®€å•

### 4.5 å¼‚æ­¥æ”¯æŒ
- [ ] spawn å®å®ç°ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼‰
- [ ] Future<T> æ“ä½œï¼ˆget, get(timeout), tryGet, cancelï¼‰
- [ ] çº¿ç¨‹å·¥å…·ï¼ˆThread.currentThread, id, hasPendingCancellationï¼‰

> è®¾è®¡è¯´æ˜ï¼š
> - ä½¿ç”¨ä»“é¢‰çš„ spawn + Future<T> æ¨¡å‹ï¼ˆé async/await è¯­æ³•ï¼‰
> - spawn åˆ›å»ºçº¿ç¨‹å¹¶è¿”å› Future<T>
> - Future<T> æä¾›ç»“æœè·å–å’Œå–æ¶ˆæœºåˆ¶
> - å‚è€ƒ std.sync å’Œ std.core.Future<T> API

### 4.6 å®ç³»ç»Ÿå¢å¼º
- [ ] å®å±•å¼€è°ƒè¯•å·¥å…·
- [ ] å®å«ç”Ÿæ€§æ£€æŸ¥
- [ ] compile-time è®¡ç®—

### 4.7 é”™è¯¯å¤„ç†å’Œè°ƒè¯•
- [ ] é”™è¯¯ç±»å‹ç³»ç»Ÿ
- [ ] è°ƒç”¨æ ˆè¿½è¸ª
- [ ] è°ƒè¯•å™¨ (debugger)
- [ ] æ€§èƒ½åˆ†æ

### 4.8 æ–‡æ¡£å’Œå·¥å…·
- [ ] API æ–‡æ¡£ç”Ÿæˆ
- [ ] åŒ…ç®¡ç†å™¨ (cjlpm)
- [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- [ ] REPL å¢å¼ºåŠŸèƒ½

---

## ğŸ“ å¾…ä¿®å¤é—®é¢˜

### é«˜ä¼˜å…ˆçº§
- [x] ~~ä¿®å¤å®çš„çº¯å¯å˜å‚æ•° bugï¼ˆbindMacroParamsï¼‰~~ âœ… å·²ä¿®å¤ (2026-01-27)
  - é—®é¢˜ï¼š`(. args)` åªç»‘å®šç¬¬ä¸€ä¸ªå‚æ•°
  - ä¿®å¤ä½ç½®ï¼š`src/parser/parser.cj`, `src/core/eval_core.cj`
  - å½±å“ï¼šç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å®çš„çº¯å¯å˜å‚æ•°

### ä¸­ä¼˜å…ˆçº§
- [x] ~~å®ç°å‘½åå‚æ•°å’Œé»˜è®¤å€¼~~ âœ… å·²å®Œæˆ (2026-01-27)
  - åŠŸèƒ½ï¼š`&key` å‚æ•°å’Œ `(x default)` è¯­æ³•
  - å¤æ‚åº¦ï¼šä¸­
  - å®ç°ï¼š
    - æ‰©å±• `ParamInfo` ç±»æ”¯æŒ `isKey` å’Œ `defaultValue` å­—æ®µ
    - æ·»åŠ  `ProcedureFromParams` å’Œ `MacroFromParams` ç±»å‹
    - ä¿®æ”¹ `extractParamsWithRest` è¯†åˆ« `&key` æ ‡è®°å’Œ `(param default)` è¯­æ³•
    - ä¿®æ”¹ `applyProcedure` å®ç°ä¸‰é˜¶æ®µå‚æ•°ç»‘å®šï¼ˆä½ç½®â†’å‘½åâ†’å¯å˜ï¼‰
    - ä¿®æ”¹ `evalArguments` ä¸æ±‚å€¼ `:keyword` ç¬¦å·
    - æ›´æ–° `evalFunctionCall` ä½¿ç”¨æ¨¡å¼åŒ¹é…æ”¯æŒæ–°æ—§ç±»å‹
  - æ–‡æ¡£ï¼šæ·»åŠ  `docs/syntax/01-basics.md` é«˜çº§å‚æ•°ç‰¹æ€§ç« èŠ‚
  - ç¤ºä¾‹ï¼šåˆ›å»º `examples/02-intermediate/06_keyword_args.lisp`
  - æµ‹è¯•ï¼š213 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆæ–°å¢ `testKeywordParameters`ï¼‰

### ä½ä¼˜å…ˆçº§
- [ ] ä»“é¢‰åå‘è°ƒç”¨ Lisp å‡½æ•°

---

## ğŸ”§ ä»£ç  TODO

- [ ] src/interpreter.cj:607 - evalFile æ–‡ä»¶è¯»å–

---

## ğŸ“… æ›´æ–°è®°å½•

- 2026-01-27: **å‘½åå‚æ•°å’Œé»˜è®¤å€¼å®ç°** âœ…
  - å®ç° Common Lisp é£æ ¼çš„å‘½åå‚æ•°ï¼ˆ&keyï¼‰å’Œé»˜è®¤å€¼åŠŸèƒ½
  - ä¿®æ”¹ `src/types/types.cj`:
    - å°† `ParamInfo` ç±»ç§»åˆ° types.cjï¼ˆLispValue enum ä¹‹å‰ï¼‰
    - æ·»åŠ  `isKey: Bool` å’Œ `defaultValue: ?LispValue` å­—æ®µ
    - æ·»åŠ  `ProcedureFromParams` å’Œ `MacroFromParams` æšä¸¾å˜ä½“
    - æ›´æ–° `cloneValue`, `isProcedure`, `isMacro`, `toString` æ–¹æ³•
  - ä¿®æ”¹ `src/core/eval_macro.cj`:
    - ç§»é™¤ `ParamInfo` å®šä¹‰ï¼ˆç§»åˆ° types.cjï¼‰
    - ä¿®æ”¹ `extractParamsWithRest` æ”¯æŒï¼š
      - çº¯å¯å˜å‚æ•°ï¼ˆSymbol å¤„ç† `(func . args)`ï¼‰
      - `&key` æ ‡è®°è¿›å…¥å‘½åå‚æ•°åŒºåŸŸ
      - `(param default)` è¯­æ³•è§£æé»˜è®¤å€¼
    - æ·»åŠ  `hasKeyOrDefaultParams` è¾…åŠ©å‡½æ•°
    - æ›´æ–° `evalDefmacro` æ”¯æŒå‘½åå‚æ•°
  - ä¿®æ”¹ `src/core/eval_special_forms.cj`:
    - æ·»åŠ  `hasKeyOrDefaultParams` è¾…åŠ©å‡½æ•°
    - ä¿®æ”¹ `evalLambda` ä½¿ç”¨ `extractParamsWithRest` å¹¶æ±‚å€¼é»˜è®¤å€¼
    - ä¿®æ”¹ `evalDefine` æ”¯æŒå‘½åå‚æ•°
  - ä¿®æ”¹ `src/core/eval_higher_order.cj`:
    - ä¿®æ”¹ `evalArguments` ä¸æ±‚å€¼ `:keyword` ç¬¦å·
    - å®ç° `ProcedureFromParams` çš„å®Œæ•´å‚æ•°ç»‘å®šé€»è¾‘ï¼ˆä¸‰é˜¶æ®µï¼‰
    - ç§»é™¤è°ƒè¯• println è¯­å¥
  - ä¿®æ”¹ `src/core/eval_core.cj`:
    - æ›´æ–° `evalFunctionCall` ä½¿ç”¨æ¨¡å¼åŒ¹é…å¤„ç†æ–°æ—§ç±»å‹
  - æ·»åŠ å•å…ƒæµ‹è¯•ï¼š`src/modern_test.cj:testKeywordParameters`ï¼ˆ6ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
  - æ–‡æ¡£æ›´æ–°ï¼š`docs/syntax/01-basics.md` æ·»åŠ "é«˜çº§å‚æ•°ç‰¹æ€§"ç« èŠ‚
  - ç¤ºä¾‹æ–‡ä»¶ï¼š`examples/02-intermediate/06_keyword_args.lisp`
  - æµ‹è¯•è¦†ç›–ï¼š213 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆæ–°å¢ 1 ä¸ªæµ‹è¯•ï¼‰
  - å‘åå…¼å®¹ï¼šä¿ç•™æ—§çš„ `Procedure` å’Œ `Macro` ç±»å‹

- 2026-01-27: **match HashMap æ¨¡å¼åŒ¹é…å®ç°** âœ…
  - å®ç° match è¡¨è¾¾å¼ä¸­çš„ HashMap æ¨¡å¼åŒ¹é…åŠŸèƒ½
  - ä¿®æ”¹ `src/core/eval_pattern_match.cj`:
    - `evalMatch()` - HashMap æ¨¡å¼è·¯ç”±ï¼ˆlines 100-107ï¼‰
    - `matchPattern()` - HashMap æ¨¡å¼æ£€æµ‹ï¼ˆlines 369-381ï¼‰
    - `matchHashMapPattern()` - HashMap æ¨¡å¼åŒ¹é…å®ç°ï¼ˆlines 526-598ï¼‰
  - ä¿®æ”¹ `src/core/eval_helpers.cj`:
    - `extractHashMapBindings()` - è¿”å›ç±»å‹æ”¹ä¸º `ArrayList<(String, LispValue)>` ä»¥æ”¯æŒå¸¸é‡åŒ¹é…
  - æ·»åŠ å•å…ƒæµ‹è¯•ï¼š`src/modern_test.cj:testMatchHashMapPattern` (7ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - é›†æˆæµ‹è¯•ï¼š`lisp-tests/match_hashmap_test.lisp`
  - å…³é”®ä¿®å¤ï¼šå°† HashMap æ¨¡å¼çš„ `areAllPatterns` ä» `false` æ”¹ä¸º `true`
  - æµ‹è¯•è¦†ç›–ï¼š210 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆæ–°å¢ 1 ä¸ªæµ‹è¯•ï¼‰
  - æ›´æ–° UNSUPPORTED_FEATURES.mdï¼šmatch HashMap æ¨¡å¼ä»ä¸æ”¯æŒç§»åˆ°å·²å®ç°
  - ä¸æ”¯æŒåŠŸèƒ½ä» 2 ä¸ªå‡å°‘åˆ° 1 ä¸ª

- 2026-01-27: **HashMap è§£æ„å®ç°** âœ…
  - å®ç° let è¡¨è¾¾å¼ä¸­çš„ HashMap è§£æ„ï¼š`(let [{:key1 var1 :key2 var2} hashmap-value] ...)`
  - ä¿®æ”¹ `src/core/eval_helpers.cj`:
    - `isHashMapDestructurePattern()` - æ£€æµ‹ `(hashmap (quote :key) var)` æ ¼å¼
    - `extractHashMapBindings()` - ä»è§£æåçš„ HashMap æ¨¡å¼ä¸­æå–é”®å€¼å¯¹
    - `processHashMapDestructure()` - ä» HashMap å€¼ä¸­è·å–å¹¶ç»‘å®šå˜é‡
  - æ·»åŠ å•å…ƒæµ‹è¯•ï¼š`src/modern_test.cj:testHashMapDestructuring` (8ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - é›†æˆæµ‹è¯•ï¼š`lisp-tests/hashmap_destruct_test.lisp`
  - ä»£ç ä¼˜åŒ–ï¼šå‡å°‘ match åµŒå¥—å±‚çº§ï¼ˆä» 11 å±‚é™åˆ° 6-8 å±‚ï¼‰
  - æµ‹è¯•è¦†ç›–ï¼š209 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆæ–°å¢ 1 ä¸ªæµ‹è¯•ï¼‰
  - æ›´æ–° UNSUPPORTED_FEATURES.mdï¼šHashMap è§£æ„ä»ä¸æ”¯æŒç§»åˆ°å·²å®ç°
  - ä¸æ”¯æŒåŠŸèƒ½ä» 3 ä¸ªå‡å°‘åˆ° 2 ä¸ª

- 2026-01-27: **shebang æ”¯æŒ** âœ…
  - å®ç° Lexer.skipShebang() æ–¹æ³•ï¼Œè·³è¿‡ #! å¼€å¤´çš„è¡Œ
  - æ”¯æŒå¯æ‰§è¡Œçš„ .lisp è„šæœ¬æ–‡ä»¶
  - æ·»åŠ  4 ä¸ª shebang å•å…ƒæµ‹è¯•ï¼ˆé€šè¿‡ç‡ 100%ï¼‰
  - æµ‹è¯•è„šæœ¬ï¼šlisp-tests/test_shebang.lisp
  - æ›´æ–° task.mdï¼šæ ‡è®° shebang æ”¯æŒå·²å®Œæˆ
  - å­¦ä¹ ä»“é¢‰å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡è¯­æ³•ï¼ˆcangjie-mem è®°å¿† ID: 175ï¼‰

- 2026-01-27: **å®çš„çº¯å¯å˜å‚æ•° Bug ä¿®å¤** âœ…
  - ä¿®å¤è§£æå™¨ï¼š`src/parser/parser.cj:93` - æ­£ç¡®è§£æç‚¹å·
  - ä¿®å¤æ±‚å€¼å™¨ï¼š`src/core/eval_core.cj:169-172` - æ­£ç¡®å¤„ç†å®è°ƒç”¨
  - æ·»åŠ å•å…ƒæµ‹è¯•ï¼š`src/modern_test.cj:testMacroRestParameters` (5ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - ä¼˜åŒ–æµ‹è¯•ï¼šå°†ä¸ä¸¥è°¨çš„ `.contains()` æ–­è¨€æ”¹ä¸ºç²¾ç¡®åŒ¹é…
  - æµ‹è¯•è¦†ç›–ï¼š208 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - æ›´æ–° UNSUPPORTED_FEATURES.mdï¼š
    - å®çš„çº¯å¯å˜å‚æ•°ä»ä¸æ”¯æŒåˆ—è¡¨ç§»åˆ°å·²å®ç°åˆ—è¡¨
    - æ·»åŠ ä¿®å¤å†å²è®°å½•
    - ä¸æ”¯æŒåŠŸèƒ½ä» 4 ä¸ªå‡å°‘åˆ° 3 ä¸ª

- 2026-01-27: **å¯å˜å‚æ•°å’Œå®ç³»ç»Ÿ** âœ…
  - å®ç° lambda å¯å˜å‚æ•°ï¼ˆ. rest å’Œ &rest restï¼‰
  - å®ç° define å‡½æ•°å¯å˜å‚æ•°
  - å®ç° ,@ (comma-at) æ‹¼æ¥åŠŸèƒ½
  - å®ç° eval ç‰¹æ®Šå½¢å¼
  - ä¿®å¤ macroexpand è¿”å›è¯­æ³•æ ‘
  - æµ‹è¯•è¦†ç›–ï¼š207 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - å‘ç°å®çš„çº¯å¯å˜å‚æ•° bugï¼ˆå¾…ä¿®å¤ï¼‰
  - æ›´æ–° UNSUPPORTED_FEATURES.mdï¼ˆ4 ä¸ªä¸æ”¯æŒåŠŸèƒ½ + 1 ä¸ªè®¾è®¡é™åˆ¶ï¼‰
  - è®°å½•å‘½åå‚æ•°å’Œé»˜è®¤å‚æ•°ç‰¹æ€§åˆ°é¡¹ç›®è®°å¿†

- 2026-01-24: æ›´æ–°å¼‚æ­¥æ”¯æŒä¸º spawn + Future<T> æ¨¡å‹
- 2026-01-24: åˆ é™¤ std.collection æ¨¡å—ï¼ˆLisp Cons å·²å¤Ÿç”¨ï¼‰
- 2026-01-24: æ·»åŠ å¼‚æ­¥æ”¯æŒä»»åŠ¡ï¼ˆawait/await-allï¼‰
- 2026-01-24: æ¨¡å—ç³»ç»ŸåŸºç¡€å®Œæˆï¼Œé‡‡ç”¨ç²¾ç¡®ç‰ˆæœ¬ç®¡ç†
- 2026-01-24: ç§»é™¤ç‰ˆæœ¬èŒƒå›´è¯­æ³•ï¼Œä¿æŒè®¾è®¡ç®€å•
- 2026-01-23: æ¨¡å—ç³»ç»Ÿæµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2026-01-22: ç°ä»£åŒ–è¯­æ³•å’Œæ¡¥æ¥å±‚å®Œæˆ
- 2026-01-21: æ ¸å¿ƒ MVP å®Œæˆ
